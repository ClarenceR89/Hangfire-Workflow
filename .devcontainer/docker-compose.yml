version: "3.4"
services:
    hangfire-workflow:
        container_name: dev-hangfire-workflow
        build:
            context: ..
            dockerfile: ./.devcontainer/Dockerfile
        volumes:
            # Update this to wherever you want VS Code to mount the folder of your project
            - ..:/workspace:delegated
            # Forwards the local Docker socket to the container.
            - /var/run/docker.sock:/var/run/docker.sock
            # make sure to mount persistent directories for the node_modules,
            # this makes sure we don't copy osX files into the linux distro
            - wfapi-bin:/workspace/src/Workflow.Api/bin:delegated
            - wfapi-obj:/workspace/src/Workflow.Api/obj:delegated

            - dash-bin:/workspace/src/Dashboard/bin:delegated
            - dash-obj:/workspace/src/Dashboard/obj:delegated

            - hflib-bin:/workspace/src/Hangfier.Lib/bin:delegated
            - hflib-obj:/workspace/src/Hangfire.Lib/obj:delegated

            - wflib-bin:/workspace/src/Workflow.Lib/bin:delegated
            - wflib-obj:/workspace/src/Workflow.Lib/obj:delegated

            - worker-bin:/workspace/src/Worker/bin:delegated
            - worker-obj:/workspace/src/Worker/obj:delegated

            - bash-history:/root/.bash_history:delegated
            - extensions:/root/.vscode-server/extensions:delegated
        # Overrides default command so things don't shut down after the process ends.
        command: sleep infinity
        networks:
            - app-network

volumes:
    bash-history:
    extensions:
    wfapi-bin:
    wfapi-obj:
    dash-bin:
    dash-obj:
    hflib-bin:
    hflib-obj:
    wflib-bin:
    wflib-obj:
    worker-bin:
    worker-obj:

networks:
    app-network:
        external:
            name: rimu-meta-eu1-devtools_app-network
